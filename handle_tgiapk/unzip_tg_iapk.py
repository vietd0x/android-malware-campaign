from zipfile import ZipFile
import os
import subprocess

rootfs = "unzip_tg.iapk"
# unzip 
with ZipFile('tg.iapk', "r") as archive:
    passwd = bytearray.fromhex(archive.comment.split(b'@')[1].decode())
    archive.extractall(rootfs, pwd=bytes(passwd))

# decrypt all file
flist = []
for root, dirs, files in os.walk(rootfs):
    for file in files:
        flist.append(os.path.join(root, file))

for fn in flist:
    try:
        subprocess.run(["python", "script\decrypt.py", fn], capture_output=False)
    except Exception as e:
        print(f"[!!!] {fn}")
        raise e


#for fn in flist:
#    if(os.path.isfile(fn)):
